<html>
    <head>
        <title>Search</title>
    </head>
    <body>
        <div id="search">
            <label for="query">Search</label>
            <input type="text" id="query"></input>
            <button onclick="search()">search</button>
        </div>
        <div id="results">
        </div>
    <script>
        function setData(data) {
            var resultContainer = document.getElementById("results")

            while (resultContainer.hasChildNodes()) {
                resultContainer.removeChild(resultContainer.lastChild);
            }

            for (var i = 0; i < data.results.length; i++) {
                console.log("have data " + data.results[i].url);
                var div = document.createElement("div");
                var link = document.createElement("a");
                link.title = data.results[i].title;
                link.href = data.results[i].url;
                link.appendChild(document.createTextNode(data.results[i].title))

                div.appendChild(link);

                resultContainer.appendChild(div);
            }
        }

        function setError(err) {
            var resultContainer = document.getElementById("results")

            while (resultContainer.hasChildNodes()) {
                resultContainer.removeChild(resultContainer.lastChild);
            }

            resultContainer.innerHTML = "Error searching: " + err;
        }

        function search() {
            var query = document.getElementById("query").value

            fetch('http://localhost/search?q=' + query)
                .then(function (response) {
                    return response.json();
                })
                .then(function (data) {
                    setData(data);
                })
                .catch(function (err) {
                    setError(err);
                });
        }

    </script>
    </body>
</html>
